<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ä¹¦åˆ—è¡¨å±•ç¤º</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/list.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script src="js/jq-paginator.js"></script>
    <link rel="icon" type="image/png" href="/pic/favicon.ico">
</head>

<body>
    <div class="bookContainer">
        <h2>å›¾ä¹¦åˆ—è¡¨å±•ç¤º</h2>
        <div class="navbar-justify-between">
            <div>
                <button class="btn btn-outline-info" type="button" onclick="location.href='book_add.html'">æ·»åŠ å›¾ä¹¦</button>
                <button class="btn btn-outline-info" type="button" onclick="batchDelete()">æ‰¹é‡åˆ é™¤</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <td>é€‰æ‹©</td>
                    <td class="width100">å›¾ä¹¦ID</td>
                    <td>ä¹¦å</td>
                    <td>ä½œè€…</td>
                    <td>æ•°é‡</td>
                    <td>å®šä»·</td>
                    <td>å‡ºç‰ˆç¤¾</td>
                    <td>çŠ¶æ€</td>
                    <td class="width200">æ“ä½œ</td>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>

        <div class="demo">
            <ul id="pageContainer" class="pagination justify-content-center"></ul>
        </div>
        <script>
            getBookList();
            function getBookList() {
                $.ajax({
                    url: "/book/getListByPage" + location.search, // ğŸ’¥ğŸ’¥ğŸ’¥
                    type: "get",
                    success: function(result) {
                        console.log(result);
                        if(result == null || result.code == "UNLOGIN") {
                            alert(result.errMsg);
                            location.href = "login.html";
                        }

                        console.log(location.search);
                        let finalHtml = "";
                        for (var book of result.data.records) {
                            finalHtml += '<tr>';
                            finalHtml += '<td><input type="checkbox" name="selectBook" value="' + book.id + '" id="selectBook" class="book-select"></td>';
                            finalHtml += '<td>' + book.id + '</td>';
                            finalHtml += '<td>' + book.bookName + '</td>';
                            finalHtml += '<td>' + book.author + '</td>';
                            finalHtml += '<td>' + book.count + '</td>';
                            finalHtml += '<td>' + book.price + '</td>';
                            finalHtml += '<td>' + book.publish + '</td>';
                            finalHtml += '<td>' + book.statusCN + '</td>';
                            finalHtml += '<td><div class="op">';
                            finalHtml += '<a href="book_update.html?bookId=' + book.id + '">ä¿®æ”¹</a>';
                            finalHtml += '<a href="javascript:void(0)" onclick="deleteBook(' + book.id + ')">åˆ é™¤</a>';
                            finalHtml += '</div></td></tr>';
                        }
                        $("tbody").html(finalHtml); // ğŸ’¥ğŸ’¥ğŸ’¥

                        // ç¿»é¡µä¿¡æ¯ğŸ’¥ğŸ’¥ğŸ’¥
                        $("#pageContainer").jqPaginator({
                            totalCounts: result.data.total,    // âœ… æ€»è®°å½•æ•°ğŸ’¥ğŸ’¥ğŸ’¥
                            pageSize: 10,                 // âœ… æ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®
                            visiblePages: 5,              // âœ… åŒæ—¶æ˜¾ç¤ºæœ€å¤š5ä¸ªåˆ†é¡µæŒ‰é’®ï¼ˆä¾‹å¦‚ 1 2 3 4 5ï¼‰
                            currentPage: result.data.pageRequest.currentPage, // âœ… åˆå§‹åŠ è½½æ—¶å½“å‰åœ¨ç¬¬1é¡µğŸ’¥ğŸ’¥ğŸ’¥
                            first: '<li class="page-item"><a class="page-link">ğŸ  é¦–é¡µ</a></li>',
                            prev: '<li class="page-item"><a class="page-link" href="javascript:void(0);">ğŸ‘ˆ ä¸Šä¸€é¡µ<\/a><\/li>',
                            next: '<li class="page-item"><a class="page-link" href="javascript:void(0);">ä¸‹ä¸€é¡µ ğŸ‘‰<\/a><\/li>',
                            last: '<li class="page-item"><a class="page-link" href="javascript:void(0);">æœ€åä¸€é¡µ ğŸ<\/a><\/li>',
                            page: '<li class="page-item"><a class="page-link" href="javascript:void(0);">{{page}}<\/a><\/li>',
                            //é¡µé¢åˆå§‹åŒ–å’Œé¡µç ç‚¹å‡»æ—¶éƒ½ä¼šæ‰§è¡Œ
                            onPageChange: function (page, type) {
                                // ğŸ’¥ğŸ’¥ğŸ’¥ä¸åŠ åˆ¤æ–­çš„è¯ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¹Ÿä¼šè¿›æ¥ï¼Œæ­¤æ—¶ä¼šç›´æ¥è·³è½¬å½“å‰é¡µé¢ï¼Œå¯¼è‡´æ­»å¾ªç¯
                                if(type == "change") {
                                    location.href = "book_list.html?currentPage=" + page;
                                }
                            }
                        });
                    }
                });
            }

            function deleteBook(id) {
                var isDelete = confirm("ç¡®è®¤åˆ é™¤?");
                if (isDelete) {
                    //åˆ é™¤å›¾ä¹¦
                    $.ajax({
                       url: "book/updateBook",
                       type: "post",
                       data: {
                           id: id,
                           status: 0
                       },
                        success: function(result) {
                           if(result == "") {
                               alert("åˆ é™¤æˆåŠŸ");
                               getBookList();
                           } else {
                               alert(result);
                           }
                        }
                    });
                }
            }

            function batchDelete() {
                var isDelete = confirm("ç¡®è®¤æ‰¹é‡åˆ é™¤?");
                if (isDelete) {
                    //è·å–å¤é€‰æ¡†çš„id
                    var ids = [];
                    $("input:checkbox[name='selectBook']:checked").each(function () {
                        ids.push($(this).val());
                    });

                    $.ajax({
                       url: "book/batchDeleteBook",
                       type: "post",
                        data: {
                            ids: ids
                        },
                        success: function(result) {
                           if(result == "") {
                               alert("æ‰¹é‡åˆ é™¤æˆåŠŸ");
                               getBookList();
                           } else {
                               alert(result);
                           }
                        }
                    });
                }
            }

        </script>
    </div>
</body>

</html>